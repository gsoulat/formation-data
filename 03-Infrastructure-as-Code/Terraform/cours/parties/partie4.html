<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 4 : Variables et Outputs</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <link href="../assets/style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="terraform-logo">‚ö°</span> Module 4 : Variables et Outputs</h1>
            <p>Rendre votre code Terraform flexible et r√©utilisable</p>
        </header>

        <div class="content">
            <div class="objectives">
                <h2>üéØ Objectifs du Module</h2>
                <ul>
                    <li>Comprendre l'importance des variables dans Terraform</li>
                    <li>D√©clarer et utiliser diff√©rents types de variables</li>
                    <li>Ma√Ætriser les diff√©rentes m√©thodes pour fournir des valeurs</li>
                    <li>Cr√©er et utiliser des outputs pour extraire des informations</li>
                </ul>
            </div>

            <section id="variables-outputs">
                <h2>üìä Variables et Outputs</h2>

                <h3>Pourquoi utiliser des variables ?</h3>
                <ul>
                    <li>Rendre le code r√©utilisable</li>
                    <li>S√©parer la configuration des valeurs</li>
                    <li>G√©rer diff√©rents environnements (dev, staging, prod)</li>
                    <li>Faciliter la maintenance</li>
                </ul>

                <h3>D√©claration de Variables</h3>

                <div class="example-box">
                    <h4>üìÑ variables.tf</h4>
                    <pre><code class="language-hcl"># Variable simple
variable "location" {
  description = "Azure region pour les ressources"
  type        = string
  default     = "France Central"
}

# Variable avec validation
variable "environment" {
  description = "Environnement de d√©ploiement"
  type        = string

  validation {
    condition     = contains(["dev", "staging", "prod"], var.environment)
    error_message = "L'environnement doit √™tre dev, staging ou prod."
  }
}

# Variable num√©rique
variable "vm_count" {
  description = "Nombre de VMs √† cr√©er"
  type        = number
  default     = 2
}

# Variable bool√©enne
variable "enable_backup" {
  description = "Activer les sauvegardes"
  type        = bool
  default     = true
}

# Variable liste
variable "allowed_ips" {
  description = "IPs autoris√©es"
  type        = list(string)
  default     = ["10.0.0.0/8", "172.16.0.0/12"]
}

# Variable objet complexe
variable "vm_config" {
  description = "Configuration de la VM"
  type = object({
    size     = string
    os_disk_size = number
    admin_username = string
  })
  default = {
    size           = "Standard_B2s"
    os_disk_size   = 30
    admin_username = "azureuser"
  }
}

# Variable sensible (mot de passe)
variable "admin_password" {
  description = "Mot de passe administrateur"
  type        = string
  sensitive   = true
}</code></pre>
                </div>

                <h3>Utilisation des Variables</h3>

                <div class="example-box">
                    <h4>üìÑ main.tf (avec variables)</h4>
                    <pre><code class="language-hcl">resource "azurerm_resource_group" "main" {
  name     = "rg-${var.environment}-app"
  location = var.location

  tags = {
    environment = var.environment
    managed_by  = "terraform"
  }
}

resource "azurerm_virtual_network" "main" {
  name                = "vnet-${var.environment}"
  address_space       = var.allowed_ips
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
}</code></pre>
                </div>

                <h3>Fournir des Valeurs aux Variables</h3>

                <h4>M√©thode 1 : Fichier terraform.tfvars</h4>
                <div class="example-box">
                    <h4>üìÑ terraform.tfvars</h4>
                    <pre><code class="language-hcl">environment    = "dev"
location       = "France Central"
vm_count       = 3
enable_backup  = false
allowed_ips    = ["10.0.0.0/16"]

vm_config = {
  size           = "Standard_D2s_v3"
  os_disk_size   = 50
  admin_username = "adminuser"
}</code></pre>
                </div>

                <div class="warning">
                    <h4>‚ö†Ô∏è S√©curit√©</h4>
                    <p>Ne committez JAMAIS <code>terraform.tfvars</code> avec des secrets dans Git. Utilisez <code>*.tfvars</code> dans .gitignore et des syst√®mes de gestion de secrets (Azure Key Vault, HashiCorp Vault).</p>
                </div>

                <h4>M√©thode 2 : Variables d'environnement</h4>
                <pre><code class="language-bash">export TF_VAR_environment="prod"
export TF_VAR_location="West Europe"
terraform apply</code></pre>

                <h4>M√©thode 3 : Ligne de commande</h4>
                <pre><code class="language-bash">terraform apply -var="environment=staging" -var="location=North Europe"</code></pre>

                <h3>Outputs (Sorties)</h3>
                <p>Les outputs permettent d'extraire des informations apr√®s le d√©ploiement.</p>

                <div class="example-box">
                    <h4>üìÑ outputs.tf</h4>
                    <pre><code class="language-hcl"># Output simple
output "resource_group_name" {
  description = "Nom du Resource Group"
  value       = azurerm_resource_group.main.name
}

# Output avec valeur sensible
output "admin_password" {
  description = "Mot de passe administrateur"
  value       = var.admin_password
  sensitive   = true
}

# Output complexe
output "vm_details" {
  description = "D√©tails des VMs cr√©√©es"
  value = {
    ids       = azurerm_virtual_machine.main[*].id
    names     = azurerm_virtual_machine.main[*].name
    public_ips = azurerm_public_ip.main[*].ip_address
  }
}

# Output de liste
output "subnet_ids" {
  description = "IDs des subnets"
  value       = azurerm_subnet.main[*].id
}</code></pre>
                </div>

                <h3>Afficher les Outputs</h3>
                <pre><code class="language-bash"># Afficher tous les outputs
terraform output

# Afficher un output sp√©cifique
terraform output resource_group_name

# Afficher en JSON
terraform output -json</code></pre>
            </section>

            <div style="margin-top: 50px; text-align: center;">
                <a href="partie3.html" style="display: inline-block; padding: 12px 30px; margin: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">‚Üê Pr√©c√©dent : Module 3</a>
                <a href="../index.html" style="display: inline-block; padding: 12px 30px; margin: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">üè† Accueil</a>
                <a href="partie5.html" style="display: inline-block; padding: 12px 30px; margin: 10px; background: linear-gradient(135deg, #0066cc 0%, #00a3e0 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">Suivant ‚Üí Module 5</a>
            </div>
        </div>

        <footer>
            <p>Formation Data Engineering - Simplon</p>
            <p>Terraform avec Azure - Module 4 : Variables et Outputs</p>
            <p>&copy; 2025 - Tous droits r√©serv√©s</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-hcl.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
</body>
</html>
