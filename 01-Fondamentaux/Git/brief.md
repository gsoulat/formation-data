# üîß Brief Pratique Git - Data Engineering

**Dur√©e estim√©e :** 6 heures
**Niveau :** D√©butant √† Interm√©diaire
**Modalit√© :** Pratique individuelle

---

## üéØ Objectifs du Brief

√Ä l'issue de ce brief, vous serez capable de :
- Cr√©er et g√©rer un d√©p√¥t Git pour un projet Data
- Utiliser les commandes Git essentielles au quotidien
- G√©rer les branches et les conflits
- Collaborer efficacement avec d'autres Data Engineers
- Mettre en place un workflow Git professionnel

---

## üìã Contexte

Vous √™tes Data Engineer chez **DataLake Solutions**. L'√©quipe d√©veloppe plusieurs pipelines ETL, mais jusqu'√† pr√©sent, le code n'√©tait pas versionn√© correctement. Vous devez mettre en place Git pour g√©rer le code de mani√®re professionnelle et collaborer efficacement.

---

## üöÄ Partie 1 : Premiers pas avec Git (1h30)

### T√¢che 1.1 : Configuration de Git

Configurez Git sur votre machine :

```bash
# Configurer votre identit√©
git config --global user.name "Votre Nom"
git config --global user.email "votre@email.com"

# Configurer l'√©diteur
git config --global core.editor "code --wait"

# Am√©liorer l'affichage
git config --global color.ui auto

# Voir votre configuration
git config --list
```

**Crit√®res de validation :**
- ‚úÖ Nom et email configur√©s
- ‚úÖ `git config --list` affiche vos informations

---

### T√¢che 1.2 : Cr√©er votre premier d√©p√¥t

Cr√©ez un nouveau projet Data Engineering :

```bash
# Cr√©er un dossier
mkdir data-pipeline-project
cd data-pipeline-project

# Initialiser Git
git init

# V√©rifier le statut
git status
```

**Crit√®res de validation :**
- ‚úÖ Dossier `.git/` cr√©√©
- ‚úÖ `git status` indique "On branch main" ou "On branch master"

---

### T√¢che 1.3 : Cr√©er des fichiers et faire votre premier commit

Cr√©ez la structure suivante :

```
data-pipeline-project/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ extract.py
‚îÇ   ‚îú‚îÄ‚îÄ transform.py
‚îÇ   ‚îî‚îÄ‚îÄ load.py
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ .gitkeep
```

**Contenu du README.md :**
```markdown
# Data Pipeline Project

Pipeline ETL pour l'extraction et le traitement de donn√©es de ventes.

## Structure
- `src/` : Code source du pipeline
- `data/` : Dossier pour les donn√©es (non versionn√©)

## Installation
pip install -r requirements.txt
```

**Contenu du requirements.txt :**
```
pandas==2.1.0
sqlalchemy==2.0.20
psycopg2-binary==2.9.7
```

**Cr√©er les fichiers Python :**

**src/extract.py :**
```python
import pandas as pd

def extract_data(source_path):
    """Extract data from CSV file"""
    df = pd.read_csv(source_path)
    print(f"Extracted {len(df)} rows")
    return df

if __name__ == "__main__":
    # Test extraction
    pass
```

**Instructions :**
1. Cr√©ez tous les fichiers
2. Ajoutez-les au staging area
3. Cr√©ez un commit avec le message : "Initial commit: setup project structure"

```bash
git add .
git commit -m "Initial commit: setup project structure"
```

**Crit√®res de validation :**
- ‚úÖ Tous les fichiers cr√©√©s
- ‚úÖ `git log` montre votre premier commit
- ‚úÖ `git status` indique "nothing to commit, working tree clean"

---

### T√¢che 1.4 : Cr√©er un .gitignore

Cr√©ez un fichier `.gitignore` pour ne pas versionner les donn√©es et fichiers temporaires :

```
# Python
__pycache__/
*.py[cod]
*.so
venv/
env/
.venv/

# Data files
data/*.csv
data/*.json
data/*.parquet
!data/.gitkeep

# Credentials
.env
credentials.json
*.pem

# Jupyter
.ipynb_checkpoints/

# IDE
.vscode/
.idea/
*.swp

# OS
.DS_Store
```

**Instructions :**
1. Cr√©ez le fichier `.gitignore`
2. Testez en cr√©ant un fichier `data/test.csv`
3. V√©rifiez que `git status` ne le montre pas
4. Commitez le `.gitignore`

**Crit√®res de validation :**
- ‚úÖ `.gitignore` cr√©√© et committ√©
- ‚úÖ Fichiers dans `data/` sont ignor√©s sauf `.gitkeep`

---

## üåø Partie 2 : Gestion des branches (1h30)

### T√¢che 2.1 : Cr√©er et utiliser des branches

**Sc√©nario :** Vous devez d√©velopper trois fonctionnalit√©s en parall√®le :
1. Fonction de transformation des donn√©es
2. Fonction de chargement dans PostgreSQL
3. Syst√®me de logs

**Instructions :**

**Branche 1 : feature/transform-data**
```bash
# Cr√©er et basculer sur la branche
git checkout -b feature/transform-data

# Modifier src/transform.py
```

**src/transform.py :**
```python
import pandas as pd

def clean_data(df):
    """Remove duplicates and null values"""
    df = df.drop_duplicates()
    df = df.dropna()
    return df

def transform_sales_data(df):
    """Transform sales data"""
    df['date'] = pd.to_datetime(df['date'])
    df['revenue'] = df['quantity'] * df['price']
    df['year'] = df['date'].dt.year
    df['month'] = df['date'].dt.month
    return df

if __name__ == "__main__":
    # Test transformations
    pass
```

```bash
# Committer
git add src/transform.py
git commit -m "Add data transformation functions"
```

**Branche 2 : feature/load-database**
```bash
# Retour sur main
git checkout main

# Nouvelle branche
git checkout -b feature/load-database

# Modifier src/load.py
```

**src/load.py :**
```python
from sqlalchemy import create_engine
import pandas as pd
import os

def load_to_postgres(df, table_name):
    """Load dataframe to PostgreSQL"""
    db_url = os.getenv('DATABASE_URL', 'postgresql://user:pass@localhost:5432/db')
    engine = create_engine(db_url)

    df.to_sql(table_name, engine, if_exists='replace', index=False)
    print(f"‚úÖ Loaded {len(df)} rows to {table_name}")

if __name__ == "__main__":
    # Test loading
    pass
```

```bash
git add src/load.py
git commit -m "Add PostgreSQL loading function"
```

**Crit√®res de validation :**
- ‚úÖ Deux branches cr√©√©es : `feature/transform-data` et `feature/load-database`
- ‚úÖ Chaque branche a au moins un commit
- ‚úÖ `git branch` liste toutes vos branches

---

### T√¢che 2.2 : Fusionner les branches

**Instructions :**
1. Retournez sur la branche `main`
2. Fusionnez `feature/transform-data`
3. Fusionnez `feature/load-database`
4. V√©rifiez que tout fonctionne
5. Supprimez les branches fusionn√©es

```bash
# Retour sur main
git checkout main

# Merge premi√®re branche
git merge feature/transform-data

# Merge deuxi√®me branche
git merge feature/load-database

# V√©rifier l'historique
git log --oneline --graph --all

# Supprimer les branches
git branch -d feature/transform-data
git branch -d feature/load-database
```

**Crit√®res de validation :**
- ‚úÖ Les deux branches sont fusionn√©es dans main
- ‚úÖ Aucun conflit
- ‚úÖ Branches supprim√©es

---

### T√¢che 2.3 : G√©rer un conflit

**Sc√©nario :** Cr√©ez volontairement un conflit pour apprendre √† le r√©soudre.

**Instructions :**

1. Cr√©ez une branche `feature/logging-v1` et modifiez `README.md` :
```bash
git checkout -b feature/logging-v1
```

Ajoutez dans README.md :
```markdown
## Logging
Ce projet utilise le module logging standard de Python.
```

```bash
git add README.md
git commit -m "Add logging info v1"
```

2. Retournez sur `main` et cr√©ez une autre branche `feature/logging-v2` :
```bash
git checkout main
git checkout -b feature/logging-v2
```

Ajoutez dans README.md (m√™me emplacement) :
```markdown
## Logging
Nous utilisons structlog pour un logging avanc√©.
```

```bash
git add README.md
git commit -m "Add logging info v2"
```

3. Fusionnez d'abord `feature/logging-v1` dans main :
```bash
git checkout main
git merge feature/logging-v1
```

4. Tentez de fusionner `feature/logging-v2` (conflit !) :
```bash
git merge feature/logging-v2
# CONFLICT!
```

5. R√©solvez le conflit :
- Ouvrez `README.md`
- Vous verrez les marqueurs `<<<<<<<`, `=======`, `>>>>>>>`
- Choisissez la version appropri√©e ou combinez les deux
- Supprimez les marqueurs

6. Finalisez :
```bash
git add README.md
git commit -m "Merge feature/logging-v2 with conflict resolution"
```

**Crit√®res de validation :**
- ‚úÖ Conflit cr√©√© volontairement
- ‚úÖ Conflit r√©solu manuellement
- ‚úÖ Fusion compl√©t√©e avec succ√®s

---

## üì§ Partie 3 : Collaboration avec GitHub (2h)

### T√¢che 3.1 : Cr√©er un d√©p√¥t sur GitHub

1. Allez sur [GitHub](https://github.com)
2. Cr√©ez un nouveau repository : `data-pipeline-project`
3. Ne cochez PAS "Initialize with README" (vous avez d√©j√† un projet local)

**Crit√®res de validation :**
- ‚úÖ Repository cr√©√© sur GitHub

---

### T√¢che 3.2 : Lier votre d√©p√¥t local √† GitHub

```bash
# Ajouter le remote
git remote add origin https://github.com/votre-username/data-pipeline-project.git

# V√©rifier
git remote -v

# Pousser le code
git push -u origin main
```

**Crit√®res de validation :**
- ‚úÖ Remote configur√©
- ‚úÖ Code visible sur GitHub

---

### T√¢che 3.3 : Workflow Pull Request

**Sc√©nario :** Vous devez ajouter une fonctionnalit√© de validation de donn√©es.

1. **Cr√©er une branche :**
```bash
git checkout -b feature/data-validation
```

2. **Cr√©er un nouveau fichier `src/validate.py` :**
```python
import pandas as pd

def validate_schema(df, expected_columns):
    """Validate dataframe schema"""
    missing_cols = set(expected_columns) - set(df.columns)
    if missing_cols:
        raise ValueError(f"Missing columns: {missing_cols}")
    return True

def validate_data_quality(df):
    """Check data quality"""
    issues = []

    # Check for nulls
    null_counts = df.isnull().sum()
    if null_counts.any():
        issues.append(f"Null values found: {null_counts[null_counts > 0].to_dict()}")

    # Check for duplicates
    dup_count = df.duplicated().sum()
    if dup_count > 0:
        issues.append(f"Found {dup_count} duplicate rows")

    return issues

if __name__ == "__main__":
    # Tests
    df = pd.DataFrame({
        'id': [1, 2, 3],
        'value': [10, 20, 30]
    })

    print("‚úÖ Schema valid:", validate_schema(df, ['id', 'value']))
    print("Issues:", validate_data_quality(df))
```

3. **Committer et pousser :**
```bash
git add src/validate.py
git commit -m "Add data validation module"
git push -u origin feature/data-validation
```

4. **Cr√©er une Pull Request sur GitHub :**
- Allez sur GitHub
- Cliquez sur "Compare & pull request"
- Ajoutez une description :
```markdown
## Ajout d'un module de validation

### Changements
- Nouvelle fonction de validation de sch√©ma
- Nouvelle fonction de validation de qualit√© des donn√©es

### Tests
- [x] Test√© localement avec des donn√©es de test
- [x] Pas de r√©gression

### √Ä reviewer
- V√©rifier la logique de validation
- Sugg√©rer des am√©liorations
```

5. **Merger la PR :**
- Cliquez sur "Merge pull request"
- Confirmez le merge

6. **Mettre √† jour votre d√©p√¥t local :**
```bash
git checkout main
git pull origin main
git branch -d feature/data-validation
```

**Crit√®res de validation :**
- ‚úÖ Branche cr√©√©e et pouss√©e sur GitHub
- ‚úÖ Pull Request cr√©√©e et merg√©e
- ‚úÖ D√©p√¥t local √† jour

---

## üï∞Ô∏è Partie 4 : Historique et debugging (1h)

### T√¢che 4.1 : Explorer l'historique

```bash
# Historique complet
git log

# Format condens√©
git log --oneline

# Avec graphe
git log --oneline --graph --all

# Filtrer par auteur
git log --author="Votre Nom"

# Derniers 5 commits
git log -5

# Chercher dans les messages de commit
git log --grep="validation"
```

**Crit√®res de validation :**
- ‚úÖ Vous savez afficher l'historique de diff√©rentes mani√®res

---

### T√¢che 4.2 : Voir les modifications d'un commit

```bash
# D√©tails d'un commit sp√©cifique
git show <commit-hash>

# Voir uniquement les fichiers modifi√©s
git show --name-only <commit-hash>

# Voir les stats
git show --stat <commit-hash>
```

---

### T√¢che 4.3 : Retrouver qui a modifi√© une ligne

```bash
# Voir qui a modifi√© chaque ligne d'un fichier
git blame src/extract.py

# Format plus lisible
git blame -L 1,10 src/extract.py
```

---

### T√¢che 4.4 : Chercher dans l'historique

**Sc√©nario :** Vous avez introduit un bug mais ne savez pas quand.

```bash
# Chercher un mot dans tous les commits
git log -S "extract_data"

# Voir les diff√©rences
git log -p -S "extract_data"
```

**Crit√®res de validation :**
- ‚úÖ Vous savez retrouver qui a modifi√© une ligne
- ‚úÖ Vous savez chercher dans l'historique

---

## üîÑ Partie 5 : Workflows avanc√©s (30 min)

### T√¢che 5.1 : Utiliser git stash

**Sc√©nario :** Vous √™tes en train de coder, mais on vous demande de corriger un bug urgent.

```bash
# Vous √™tes en train de modifier extract.py
# Sauvegarder temporairement
git stash

# Corriger le bug sur une autre branche
git checkout -b hotfix/urgent-bug
# ... corrections ...
git commit -am "Fix urgent bug"
git checkout main
git merge hotfix/urgent-bug

# R√©cup√©rer votre travail en cours
git stash pop
```

**Crit√®res de validation :**
- ‚úÖ Vous savez mettre de c√¥t√© des modifications
- ‚úÖ Vous savez les r√©cup√©rer

---

### T√¢che 5.2 : Modifier le dernier commit

**Sc√©nario :** Vous avez oubli√© un fichier dans le dernier commit.

```bash
# Faire votre commit
git commit -m "Add feature X"

# Oups, j'ai oubli√© un fichier !
git add fichier_oublie.py

# Modifier le dernier commit
git commit --amend --no-edit
```

---

### T√¢che 5.3 : Cr√©er des tags

**Sc√©nario :** Vous venez de finaliser la version 1.0.0 de votre pipeline.

```bash
# Cr√©er un tag annot√©
git tag -a v1.0.0 -m "Release version 1.0.0 - Production ready"

# Voir les tags
git tag

# Pousser le tag
git push origin v1.0.0

# Voir les d√©tails d'un tag
git show v1.0.0
```

**Crit√®res de validation :**
- ‚úÖ Tag cr√©√© et pouss√© sur GitHub
- ‚úÖ Visible dans l'interface GitHub (Releases)

---

## üéÅ Bonus : Automatisation (Optionnel)

### Bonus 1 : Git Aliases

Cr√©ez des raccourcis pour vos commandes fr√©quentes :

```bash
git config --global alias.st status
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.unstage 'reset HEAD --'
git config --global alias.last 'log -1 HEAD'
git config --global alias.visual 'log --oneline --graph --all'

# Utilisation
git st  # au lieu de git status
git visual  # pour voir le graphe
```

### Bonus 2 : Pre-commit hooks

Cr√©ez un hook pour v√©rifier le code avant chaque commit :

```bash
# Cr√©er le fichier .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

**Contenu de pre-commit :**
```bash
#!/bin/bash

# V√©rifier qu'on ne commite pas de secrets
if git diff --cached | grep -i "password\|secret\|api_key"; then
    echo "‚ùå Attention ! Vous tentez de commiter des secrets !"
    exit 1
fi

echo "‚úÖ Pre-commit check passed"
exit 0
```

---

## üì§ Livrables

√Ä la fin du brief, vous devez avoir :

1. **Un d√©p√¥t Git local et sur GitHub** contenant :
   - Structure de projet compl√®te
   - Plusieurs commits significatifs
   - Historique propre avec branches fusionn√©es

2. **Un fichier RECAP.md** documentant :
   - Les commandes Git que vous avez apprises
   - Les difficult√©s rencontr√©es et comment vous les avez r√©solues
   - Un sch√©ma de votre workflow Git

3. **Captures d'√©cran** :
   - Historique Git avec `git log --graph`
   - Pull Request sur GitHub
   - Release avec tag

---

## ‚úÖ Crit√®res d'√âvaluation

| Crit√®re | Points |
|---------|--------|
| Configuration Git correcte | 10 |
| Structure de projet et commits | 15 |
| Utilisation des branches | 20 |
| R√©solution de conflits | 15 |
| Workflow GitHub (PR, merge) | 20 |
| Exploration de l'historique | 10 |
| Documentation (RECAP.md) | 10 |

**Total : 100 points**

---

## üí° Conseils

- üíæ **Commitez souvent** : Mieux vaut beaucoup de petits commits qu'un gros
- üìù **Messages clairs** : Expliquez le "pourquoi", pas seulement le "quoi"
- üåø **Une branche = une fonctionnalit√©** : Ne m√©langez pas plusieurs t√¢ches
- üîÑ **Pull avant de push** : √âvitez les conflits en restant √† jour
- üö´ **N'utilisez jamais `--force`** sans √™tre s√ªr de ce que vous faites
- üìñ **Lisez les messages d'erreur** : Git est tr√®s explicite

---

## üÜò Commandes de secours

Si vous √™tes perdu :

```bash
# O√π suis-je ?
git status

# Qu'est-ce qui a chang√© ?
git diff

# Annuler mes modifications locales
git restore .

# Voir l'historique
git log --oneline

# Revenir √† un √©tat pr√©c√©dent (sans perdre les commits)
git revert <commit-hash>
```

---

## üìö Ressources

- [Pro Git Book (gratuit)](https://git-scm.com/book/fr/v2)
- [Learn Git Branching (interactif)](https://learngitbranching.js.org/?locale=fr_FR)
- [Oh Shit, Git!?](https://ohshitgit.com/fr)
- [Git Cheat Sheet](https://education.github.com/git-cheat-sheet-education.pdf)

---

**Bon courage ! üöÄ**
