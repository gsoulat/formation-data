<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partie 4 - Pods et Deployments</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üìñ Partie 4</h1>
            <p class="subtitle">Pods et Deployments</p>
            <span class="duration">‚è±Ô∏è Dur√©e : 20 minutes</span>
        </header>

        <nav class="nav-menu">
            <ul>
                <li><a href="../index.html">üè† Accueil</a></li>
                <li><a href="partie1.html">Partie 1</a></li>
                <li><a href="partie2.html">Partie 2</a></li>
                <li><a href="partie3.html">Partie 3</a></li>
                <li><a href="partie4.html">Partie 4</a></li>
                <li><a href="partie5.html">Partie 5</a></li>
                <li><a href="partie6.html">Partie 6</a></li>
                <li><a href="partie7.html">Partie 7</a></li>
                <li><a href="partie8.html">Partie 8</a></li>
                <li><a href="partie9.html">Partie 9</a></li>
            </ul>
        </nav>

        <div class="content">
            <section class="section">
                <h2>4. Pods et Deployments</h2>

                <h3>Qu'est-ce qu'un Pod ?</h3>

                <p>
                    Un <strong>Pod</strong> est la plus petite unit√© d√©ployable dans Kubernetes.
                    Il contient un ou plusieurs conteneurs qui partagent le m√™me r√©seau et le m√™me stockage.
                </p>

                <h4>Pod simple (YAML)</h4>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.25
    ports:
    - containerPort: 80</code></pre>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-bash"># Cr√©er le Pod
kubectl apply -f nginx-pod.yaml

# V√©rifier
kubectl get pods
kubectl describe pod nginx-pod

# Voir les logs
kubectl logs nginx-pod

# Se connecter au Pod
kubectl exec -it nginx-pod -- bash

# Supprimer
kubectl delete pod nginx-pod</code></pre>
                </div>

                <div class="alert alert-warning">
                    <h4>Ne pas utiliser les Pods seuls</h4>
                    <p>
                        En production, on n'utilise presque jamais de Pods directement.
                        On utilise des <strong>Deployments</strong> qui g√®rent les Pods automatiquement.
                    </p>
                </div>

                <h3>Deployments</h3>

                <p>
                    Un <strong>Deployment</strong> d√©clare l'√©tat d√©sir√© de vos Pods et g√®re leur cycle de vie
                    (cr√©ation, mise √† jour, scaling, self-healing).
                </p>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3  # Nombre de Pods
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.25
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: "64Mi"
            cpu: "250m"
          limits:
            memory: "128Mi"
            cpu: "500m"</code></pre>
                </div>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-bash"># Cr√©er le Deployment
kubectl apply -f nginx-deployment.yaml

# V√©rifier
kubectl get deployments
kubectl get pods  # 3 Pods cr√©√©s

# Voir le rollout status
kubectl rollout status deployment/nginx-deployment

# Scaler manuellement
kubectl scale deployment nginx-deployment --replicas=5

# Mettre √† jour l'image
kubectl set image deployment/nginx-deployment nginx=nginx:1.26

# Voir l'historique des d√©ploiements
kubectl rollout history deployment/nginx-deployment

# Rollback vers la version pr√©c√©dente
kubectl rollout undo deployment/nginx-deployment

# Supprimer
kubectl delete deployment nginx-deployment</code></pre>
                </div>

                <h3>ReplicaSet</h3>

                <p>
                    Un <strong>ReplicaSet</strong> assure qu'un nombre sp√©cifi√© de r√©plicas de Pods est toujours en cours d'ex√©cution.
                    Les Deployments cr√©ent et g√®rent automatiquement des ReplicaSets.
                </p>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-bash"># Voir les ReplicaSets
kubectl get replicasets

# Un ReplicaSet a √©t√© cr√©√© automatiquement par le Deployment
# nginx-deployment-xxxxxxxxxx   3         3         3       5m</code></pre>
                </div>

                <h3>Strat√©gies de d√©ploiement</h3>

                <div class="code-container">
                    <div class="code-header">
                        <span class="code-dot red"></span>
                        <span class="code-dot yellow"></span>
                        <span class="code-dot green"></span>
                    </div>
                    <pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  strategy:
    type: RollingUpdate  # ou Recreate
    rollingUpdate:
      maxSurge: 1        # Nombre max de Pods en plus pendant le rollout
      maxUnavailable: 1  # Nombre max de Pods indisponibles pendant le rollout
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.25
        ports:
        - containerPort: 80</code></pre>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>Strat√©gie</th>
                            <th>Description</th>
                            <th>Cas d'usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>RollingUpdate</strong></td>
                            <td>Remplace progressivement les anciens Pods par des nouveaux</td>
                            <td>Par d√©faut, zero-downtime</td>
                        </tr>
                        <tr>
                            <td><strong>Recreate</strong></td>
                            <td>Supprime tous les anciens Pods avant de cr√©er les nouveaux</td>
                            <td>Quand les versions ne peuvent pas coexister</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <div class="key-points">
                <h3>Points cl√©s √† retenir</h3>
                <ul>
                    <li>Les Pods sont la plus petite unit√© d√©ployable dans Kubernetes</li>
                    <li>En production, utilisez toujours des Deployments, pas des Pods seuls</li>
                    <li>Les Deployments g√®rent les r√©plicas, les mises √† jour et le rollback</li>
                    <li>Les ReplicaSets sont cr√©√©s automatiquement par les Deployments</li>
                    <li>RollingUpdate permet des d√©ploiements sans downtime</li>
                </ul>
            </div>

            <nav class="section-nav" style="display: flex; justify-content: space-between; margin-top: 40px;">
                <a href="partie3.html" style="display: inline-block; padding: 12px 25px; background: #6c757d; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                    ‚Üê Partie 3
                </a>
                <a href="partie5.html" style="display: inline-block; padding: 12px 25px; background: #0066cc; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                    Partie 5 ‚Üí
                </a>
            </nav>
        </div>

        <footer>
            <p>Formation Kubernetes pour Data Engineering - 2024</p>
            <p><a href="../index.html">‚Üê Retour √† l'accueil</a></p>
        </footer>
    </div>

    <!-- Prism.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
</body>
</html>
